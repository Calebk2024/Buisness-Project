<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h2 {
            color: #333;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }
        nav {
                background-color: #333;
                overflow: hidden;
        }
    
        nav a {
            float: left;
            display: block;
            color: #fff;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
        }
    
        nav a:hover {
            background-color: #ddd;
            color:blue;
        }
    </style>
</head>
<body>
    <nav>
        <a href="index.html">Back to homepage</a>
        <a href="user.html">Back to user logging</a>
        <a href="visualizations.html">Visualization graph</a>
        <a href="visualizations2.html">Visualization graph 2</a>
    </nav>
    <h2>Expense Table</h2>
    <table border="1" id="dataTable">
        <thead>
            <tr>
                <th>Description</th>
                <th>Amount</th>
                <th>Category</th>
                <th>Date</th>
            </tr>
        </thead>
    </table>
    <table border="1" id="all">
        <thead>
            <tr>
                <th>Total</th>
                <th>Food Percentage</th>
                <th>Entertainment Percentage</th>
                <th>Housing Percentage</th>
                <th>Transportation Percentage</th>
                <th>Utilities Percentage</th>
            </tr>
        </thead>
    </table>
    <table border="1" id="two">
        <thead>
            <tr>
                <th>Amount spent per day</th>
                <th>Amount spent per week</th>
            </tr>
        </thead>
    </table>

    <script>
        var myArray = JSON.parse(localStorage.getItem("myArray")) || [];
        function addRowToTable(name, amount, category, date) {
            var table = document.getElementById('dataTable');
            var newRow = table.insertRow(table.rows.length);
            var cell1 = newRow.insertCell(0);
            var cell2 = newRow.insertCell(1);
            var cell3 = newRow.insertCell(2);
            var cell4 = newRow.insertCell(3);
            cell1.innerHTML = name;
            cell2.innerHTML = amount + " dollars";
            cell3.innerHTML = category;
            cell4.innerHTML = date;
        }

        function updateTable() {
            var table = document.getElementById('dataTable');
            table.innerHTML = "<thead><tr><th>Description</th><th>Amount</th><th>Category</th><th>Date</th></tr></thead>";

            for (var i = 0; i < myArray.length; i++) {
                addRowToTable(myArray[i].description, myArray[i].amount, myArray[i].category, myArray[i].transactionDate);
            }
        }

        updateTable();
        console.log(myArray);
        add=0;
        food=0;
        enter=0;
        house=0;
        trans=0;
        util=0;
        local=[];
        for (var i = 0; i < myArray.length; i++) {
            //addRowToTable(myArray[i]["description"], myArray[i]["amount"], myArray[i]["category"], myArray[i]["transactionDate"]);
            add+=Number(myArray[i]["amount"]);
            local.push(myArray[i]["transactionDate"]);
            if(myArray[i]["category"]=="food"){
                food+=Number(myArray[i]["amount"]);
            }
            if(myArray[i]["category"]=="housing"){
                house+=Number(myArray[i]["amount"]);
            }
            if(myArray[i]["category"]=="transportation"){
                trans+=Number(myArray[i]["amount"]);
            }
            if(myArray[i]["category"]=="utilities"){
                util+=Number(myArray[i]["amount"]);
            }
            if(myArray[i]["category"]=="entertainment"){
                enter+=Number(myArray[i]["amount"]);
            }
        }
        function samedates(Array){
            const same = [];
            let counter=0;
            Array.forEach(dateStr => {
                const dateObj = new Date(dateStr);
                const year = dateObj.getFullYear();
                const month = dateObj.getMonth() + 1; 
                const day = dateObj.getDate();
                const dateKey = `${year}-${month < 10 ? '0' : ''}${month}-${day < 10 ? '0' : ''}${day}`;
                bool=true;
                for (let i = 0; i < same.length; i++) {
                    if(dateKey==same[i]){
                        bool=false;
                    }
                }
                if(bool){
                    same.push(dateKey);
                    counter+=1;
                }
            });

            return counter;
        }
        function findSameWeekDates(dateArray) {
            const group = [];
            let counter=0;

            dateArray.forEach(date=> {
                const dateObj = new Date(date);
                const year = dateObj.getFullYear();
                const weekNum = getWeekNum(dateObj);
                const weekKey = `${year}-W${weekNum< 10 ? '0' : ''}${weekNum}`;
                console.log(weekKey);
                bool=true;
                for (let i = 0; i < group.length; i++) {
                    if(weekKey==group[i]){
                        bool=false;
                    }
                }
                if(bool){
                    group.push(weekKey)
                    counter+=1
                }
            });

            return counter;
        }
        
        function getWeekNum(date) {
            const target = new Date(date.valueOf());
            const dayNumber = (date.getDay() + 8) % 7;
            target.setDate(target.getDate() - dayNumber + 3);
            
            const firstThursday = target.valueOf();
            target.setMonth(0, 1);
            if (target.getDay() !== 0) {
                target.setMonth(0, 1 + ((0 - target.getDay()) + 7) % 7);
            }
            console.log(target);
            return 1 + Math.ceil((firstThursday - target) / 604800000);
        }
        
        var table = document.getElementById('all');
        var newRow = table.insertRow(table.rows.length);
        var cell1 = newRow.insertCell(0);
        var cell2 = newRow.insertCell(1);
        var cell3 = newRow.insertCell(2);
        var cell4 = newRow.insertCell(3)
        var cell5 = newRow.insertCell(4);
        var cell6 = newRow.insertCell(5);
        cell1.innerHTML = add+" dollars";
        cell2.innerHTML = parseFloat(food/add);
        cell3.innerHTML = parseFloat(enter/add);
        cell4.innerHTML = parseFloat(house/add);
        cell5.innerHTML = parseFloat(trans/add);
        cell6.innerHTML = parseFloat(util/add);
        var t=document.getElementById('two');
        var nw=t.insertRow(t.rows.length);
        var cell1 = nw.insertCell(0);
        var cell2 = nw.insertCell(1);
        cell1.innerHTML=parseFloat(add/samedates(local));
        cell2.innerHTML=parseFloat(add/findSameWeekDates(local));
        
        localStorage.setItem("food", food);
        localStorage.setItem("enter", enter);
        localStorage.setItem("house", house);
        localStorage.setItem("trans", trans);
        localStorage.setItem("util", util);
        
    </script>

</body>
</html>